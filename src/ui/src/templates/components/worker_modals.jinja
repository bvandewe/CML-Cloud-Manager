<!-- Worker Modals -->

<!-- Create Worker Modal -->
<div class="modal fade" id="createWorkerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-plus-circle"></i> Create New CML Worker
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="create-worker-form">
                    <div class="mb-3">
                        <label for="worker-name" class="form-label">Worker Name *</label>
                        <input type="text" class="form-control" id="worker-name" required
                            placeholder="e.g., cml-worker-prod-01">
                        <small class="text-muted">Human-readable name for the worker</small>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="worker-region" class="form-label">AWS Region *</label>
                            <select class="form-select" id="worker-region" required>
                                <option value="">Select Region</option>
                                <option value="us-east-1">us-east-1</option>
                                <option value="us-west-2">us-west-2</option>
                                <option value="eu-west-1">eu-west-1</option>
                                <option value="ap-southeast-1">ap-southeast-1</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="worker-instance-type" class="form-label">Instance Type *</label>
                            <select class="form-select" id="worker-instance-type" required>
                                <option value="">Select Type</option>
                                <option value="c5.xlarge">c5.xlarge (4 vCPU, 8GB)</option>
                                <option value="c5.2xlarge">c5.2xlarge (8 vCPU, 16GB)</option>
                                <option value="c5.4xlarge">c5.4xlarge (16 vCPU, 32GB)</option>
                                <option value="m5zn.metal">m5zn.metal (48 vCPU, 192GB)</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="worker-ami" class="form-label">AMI ID</label>
                        <input type="text" class="form-control" id="worker-ami"
                            placeholder="ami-xxxxxxxxxxxxxxxxx (optional)">
                        <small class="text-muted">Leave empty to use regional default</small>
                    </div>

                    <div class="mb-3">
                        <label for="worker-cml-version" class="form-label">CML Version</label>
                        <input type="text" class="form-control" id="worker-cml-version" placeholder="e.g., 2.7.0">
                    </div>

                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Note:</strong> Creating a worker will provision a new EC2 instance.
                        This may take several minutes.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="submit-create-worker-btn">
                    <i class="bi bi-plus-circle"></i> Create Worker
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Import Worker Modal -->
<div class="modal fade" id="importWorkerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-box-arrow-in-down"></i> Import Existing Worker
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="import-worker-form">
                    <div class="mb-3">
                        <label for="import-region" class="form-label">AWS Region *</label>
                        <select class="form-select" id="import-region" required>
                            <option value="">Select Region</option>
                            <option value="us-east-1">us-east-1</option>
                            <option value="us-west-2">us-west-2</option>
                            <option value="eu-west-1">eu-west-1</option>
                            <option value="ap-southeast-1">ap-southeast-1</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Import Method</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="import-method" id="import-by-instance" checked>
                            <label class="btn btn-outline-primary" for="import-by-instance">Instance ID</label>

                            <input type="radio" class="btn-check" name="import-method" id="import-by-ami">
                            <label class="btn btn-outline-primary" for="import-by-ami">AMI Name</label>
                        </div>
                    </div>

                    <div id="instance-id-group" class="mb-3">
                        <label for="import-instance-id" class="form-label">Instance ID</label>
                        <input type="text" class="form-control" id="import-instance-id"
                            placeholder="i-xxxxxxxxxxxxxxxxx">
                    </div>

                    <div id="ami-name-group" class="mb-3" style="display: none;">
                        <label for="import-ami-name" class="form-label">AMI Name Pattern</label>
                        <input type="text" class="form-control" id="import-ami-name"
                            placeholder="e.g., cisco-cml2.9-lablet-*">

                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="import-all-instances" checked>
                            <label class="form-check-label" for="import-all-instances">
                                Import all matching instances (bulk import)
                            </label>
                        </div>
                        <small class="text-muted d-block mt-1" id="import-mode-hint">
                            All instances matching the AMI pattern will be imported. Already registered instances will
                            be skipped.
                        </small>
                    </div>

                    <div class="mb-3" id="worker-name-group">
                        <label for="import-worker-name" class="form-label">Worker Name (optional)</label>
                        <input type="text" class="form-control" id="import-worker-name"
                            placeholder="Optional friendly name">
                        <small class="text-muted">Only applies to single instance import</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="submit-import-worker-btn">
                    <i class="bi bi-box-arrow-in-down"></i> Import Worker
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Worker Modal -->
<div class="modal fade" id="deleteWorkerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="bi bi-trash"></i> Delete Worker
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="delete-worker-form">
                    <input type="hidden" id="delete-worker-id">
                    <input type="hidden" id="delete-worker-region">

                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Warning:</strong> This action cannot be undone!
                    </div>

                    <p>You are about to delete worker: <strong id="delete-worker-name"></strong></p>

                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="delete-terminate-instance">
                        <label class="form-check-label" for="delete-terminate-instance">
                            <strong>Also terminate the EC2 instance</strong>
                        </label>
                        <small class="form-text text-muted d-block">
                            If checked, the EC2 instance will be permanently terminated.
                            If unchecked, only the worker record will be removed from the database
                            (instance will remain running in AWS).
                        </small>
                    </div>

                    <p class="text-muted mb-0">
                        <small>
                            <i class="bi bi-info-circle"></i>
                            This will permanently remove the worker record from the local database.
                        </small>
                    </p>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="submit-delete-worker-btn">
                    <i class="bi bi-trash"></i> Delete Worker
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Worker Details Modal -->
<div class="modal fade" id="workerDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-info-circle"></i> Worker Details
                </h5>
                <div class="d-flex align-items-center gap-3 ms-auto">
                    <small class="text-muted" id="metrics-refresh-timer" title="Time until next automatic metrics refresh">
                        <i class="bi bi-arrow-clockwise"></i> <span id="metrics-countdown">--:--</span>
                    </small>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
            </div>
            <div class="modal-body">
                <!-- Navigation Tabs -->
                <ul class="nav nav-tabs mb-3" id="workerDetailsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="overview-tab" data-bs-toggle="tab"
                            data-bs-target="#overview-panel" type="button" role="tab">
                            <i class="bi bi-hdd-stack"></i> AWS
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="cml-tab" data-bs-toggle="tab" data-bs-target="#cml-panel"
                            type="button" role="tab">
                            <i class="bi bi-diagram-3"></i> CML
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="labs-tab" data-bs-toggle="tab" data-bs-target="#labs-panel"
                            type="button" role="tab">
                            <i class="bi bi-folder2-open"></i> Labs
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="jobs-tab" data-bs-toggle="tab" data-bs-target="#jobs-panel"
                            type="button" role="tab">
                            <i class="bi bi-clock-history"></i> Jobs
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="monitoring-tab" data-bs-toggle="tab"
                            data-bs-target="#monitoring-panel" type="button" role="tab">
                            <i class="bi bi-activity"></i> Monitoring
                        </button>
                    </li>
                    <li class="nav-item admin-only-tab" role="presentation" style="display: none;">
                        <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events-panel"
                            type="button" role="tab">
                            <i class="bi bi-bell"></i> Events
                        </button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="workerDetailsTabContent">
                    <!-- EC2 Instance Details Tab (formerly Overview) -->
                    <div class="tab-pane fade show active" id="overview-panel" role="tabpanel">
                        <div id="worker-details-overview">
                            <div class="text-center py-5">
                                <div class="spinner-border" role="status"></div>
                                <p class="mt-3 text-muted">Loading worker details...</p>
                            </div>
                        </div>
                    </div>

                    <!-- CML Tab -->
                    <div class="tab-pane fade" id="cml-panel" role="tabpanel">
                        <div id="worker-details-cml">
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-diagram-3 fs-1 d-block mb-3"></i>
                                <p>CML application details will appear here</p>
                            </div>
                        </div>
                    </div>

                    <!-- Labs Tab -->
                    <div class="tab-pane fade" id="labs-panel" role="tabpanel">
                        <div id="worker-details-labs">
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-folder2-open fs-1 d-block mb-3"></i>
                                <p>Lab details will appear here</p>
                            </div>
                        </div>
                    </div>

                    <!-- Jobs Tab -->
                    <div class="tab-pane fade" id="jobs-panel" role="tabpanel">
                        <div id="worker-details-jobs">
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-clock-history fs-1 d-block mb-3"></i>
                                <p>Scheduler jobs will appear here</p>
                            </div>
                        </div>
                    </div>

                    <!-- Monitoring Tab -->
                    <div class="tab-pane fade" id="monitoring-panel" role="tabpanel">
                        <div id="worker-details-monitoring">
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-activity fs-1 d-block mb-3"></i>
                                <p>Worker monitoring status will appear here</p>
                            </div>
                        </div>
                    </div>

                    <!-- Events Tab (Admin Only) -->
                    <div class="tab-pane fade" id="events-panel" role="tabpanel">
                        <div id="worker-details-events">
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-bell fs-1 d-block mb-3"></i>
                                <p>Events will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger admin-only me-auto" id="delete-worker-from-details-btn"
                    style="display: none;" title="Delete Worker">
                    <i class="bi bi-trash"></i> Delete Worker
                </button>
                <button type="button" class="btn btn-primary" id="refresh-worker-details">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Register License Modal -->
<div class="modal fade" id="registerLicenseModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-key"></i> Register CML License
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="register-license-form">
                    <input type="hidden" id="license-worker-id">
                    <input type="hidden" id="license-worker-region">

                    <div class="mb-3">
                        <label for="license-token" class="form-label">License Token *</label>
                        <textarea class="form-control" id="license-token" rows="4" required
                            placeholder="Paste your CML license token here"></textarea>
                    </div>

                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        The license will be applied to the worker. Make sure the worker is running.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="submit-register-license-btn">
                    <i class="bi bi-key"></i> Register License
                </button>
            </div>
        </div>
    </div>
</div>

<!-- License Details Modal -->
<div class="modal fade" id="licenseDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-shield-check"></i> CML License Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs mb-3" id="licenseDetailsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="registration-tab" data-bs-toggle="tab"
                            data-bs-target="#registration-panel" type="button" role="tab">
                            <i class="bi bi-card-checklist"></i> Registration
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="authorization-tab" data-bs-toggle="tab"
                            data-bs-target="#authorization-panel" type="button" role="tab">
                            <i class="bi bi-shield-lock"></i> Authorization
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="features-tab" data-bs-toggle="tab" data-bs-target="#features-panel"
                            type="button" role="tab">
                            <i class="bi bi-puzzle"></i> Features
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="transport-tab" data-bs-toggle="tab"
                            data-bs-target="#transport-panel" type="button" role="tab">
                            <i class="bi bi-cloud-arrow-up"></i> Transport
                        </button>
                    </li>
                </ul>

                <!-- Tab content -->
                <div class="tab-content" id="licenseDetailsTabContent">
                    <!-- Registration Panel -->
                    <div class="tab-pane fade show active" id="registration-panel" role="tabpanel">
                        <div id="license-registration-content">
                            <!-- Content loaded dynamically -->
                        </div>
                    </div>

                    <!-- Authorization Panel -->
                    <div class="tab-pane fade" id="authorization-panel" role="tabpanel">
                        <div id="license-authorization-content">
                            <!-- Content loaded dynamically -->
                        </div>
                    </div>

                    <!-- Features Panel -->
                    <div class="tab-pane fade" id="features-panel" role="tabpanel">
                        <div id="license-features-content">
                            <!-- Content loaded dynamically -->
                        </div>
                    </div>

                    <!-- Transport Panel -->
                    <div class="tab-pane fade" id="transport-panel" role="tabpanel">
                        <div id="license-transport-content">
                            <!-- Content loaded dynamically -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
