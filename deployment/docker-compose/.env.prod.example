# ============================================================================
# Production Environment Configuration for CML Cloud Manager
# ============================================================================
# This file contains environment variables for the production Docker Compose setup
# in deployment/docker-compose/docker-compose.prod.yml
#
# IMPORTANT: Do NOT use this file for local development!
# Local dev uses the .env file in the project root.

# ============================================================================
# Docker Image Settings
# ============================================================================
IMAGE_REPO=ghcr.io/bvandewe/cml-cloud-manager
IMAGE_TAG=v0.1.1

# ============================================================================
# Service Images
# ============================================================================
NGINX_IMAGE=nginx:1.25-alpine
MONGODB_IMAGE=mongo:6.0.21
MONGO_EXPRESS_IMAGE=mongo-express:latest
REDIS_IMAGE=redis:7.4-alpine
KEYCLOAK_IMAGE=quay.io/keycloak/keycloak:26.0.0
EVENT_PLAYER_IMAGE=ghcr.io/bvandewe/events-player:v0.4.11
OTEL_COLLECTOR_IMAGE=otel/opentelemetry-collector-contrib:0.110.0
GRAFANA_IMAGE=grafana/grafana-enterprise:12.2.1
TEMPO_IMAGE=grafana/tempo:2.9.0
PROMETHEUS_IMAGE=prom/prometheus:v2.55.1
LOKI_IMAGE=grafana/loki:3.2.0

# ============================================================================
# Public URL Configuration
# ============================================================================
PUBLIC_STACK_URL=https://www.system.io

# ============================================================================
# Grafana OAuth Configuration
# ============================================================================
GRAFANA_CLIENT_SECRET=2wLvSl4uvjAHnsCj/pycLXMPoOaE2nIbEc/2vRLVLWw=

# ============================================================================
# Application Settings
# ============================================================================

# Python Path Configuration
PYTHONPATH=./src

# Application Settings
DEBUG=true
LOG_LEVEL=DEBUG
CORS_ORIGINS=["https://www.system.io"]
APP_HOST=0.0.0.0  # Internal bind address, required for Nginx/Worker/...
APP_PORT=8080  # Internal container port

# ============================================================================
# Nginx Reverse Proxy Settings
# ============================================================================

# Nginx listens on port 80 (HTTP) and optionally 443 (HTTPS)
NGINX_PORT=80
NGINX_SSL_PORT=443
NGINX_CONF_FILE=cml-cloud-manager.conf

# External Port Mappings (legacy - now handled by nginx)
# These are kept for reference but nginx is the main entry point
API_EXTERNAL_PORT=8020
WORKER_EXTERNAL_PORT=8021  # For monitoring/health checks

# Keycloak Settings
KEYCLOAK_PORT=8090
KEYCLOAK_ADMIN_USERNAME=admin
KEYCLOAK_ADMIN_PASSWORD=admin
KEYCLOAK_REALM=cml-cloud-manager
KEYCLOAK_CLIENT_ID=cml-cloud-manager-public
KEYCLOAK_REALM_IMPORT_FILE=cml-cloud-manager-realm-export.json

# Deprecated JWT Settings
# JWT_SECRET_KEY=your-secret-key-here-change-in-production
# JWT_ALGORITHM=HS256
# JWT_EXPIRATION_HOURS=24

# Token Claim Validation
VERIFY_ISSUER=true
EXPECTED_ISSUER=http://localhost:8090/realms/cml-cloud-manager
VERIFY_AUDIENCE=true
EXPECTED_AUDIENCE=["cml-cloud-manager"]
REFRESH_AUTO_LEEWAY_SECONDS=60
SESSION_MAX_DURATION_MINUTES=30

# ============================================================================
# Database Settings
# ============================================================================

# MongoDB Settings
MONGODB_PORT=27017
MONGODB_ROOT_USERNAME=root
MONGODB_ROOT_PASSWORD=password123
MONGODB_DATABASE=cml_cloud_manager
MONGODB_EXPRESS_PORT=8081

# ============================================================================
# Redis Settings
# ============================================================================

REDIS_PORT=6379
REDIS_ENABLED=true
REDIS_KEY_PREFIX=session:

# ============================================================================
# Infrastructure Services
# ============================================================================

# Event Player Settings
EVENT_PLAYER_PORT=8085

# OpenTelemetry Collector Settings
OTEL_COLLECTOR_GRPC_PORT=4317
OTEL_COLLECTOR_HTTP_PORT=4318
OTEL_COLLECTOR_METRICS_PORT=8888
OTEL_COLLECTOR_HEALTH_PORT=13133

# Grafana Settings
GRAFANA_PORT=3001

# Tempo Settings
TEMPO_PORT=3200

# Prometheus Settings
PROMETHEUS_PORT=9090

# Loki Settings
LOKI_PORT=3100

# ============================================================================
# Docker Network
# ============================================================================

DOCKER_NETWORK_NAME=cml-cloud-manager-net

# CML Worker Settings
CML_WORKER_AMI_NAME_DEFAULT=cisco-cml2.9-lablet-v0.1.7
CML_WORKER_INSTANCE_TYPE_DEFAULT=m5zn.metal
CML_WORKER_SECURITY_GROUP_IDS=["sg-1234567890abcdef0"]
CML_WORKER_SUBNET_ID=subnet-12345678
CML_WORKER_KEY_NAME=sys-eng
CML_WORKER_USERNAME=sysadmin
CML_WORKER_API_USERNAME=admin
CML_WORKER_API_PASSWORD=password123

# ============================================================================
# Background Job Settings
# ============================================================================

# Auto-import workers from AWS
AUTO_IMPORT_WORKERS_ENABLED=true
AUTO_IMPORT_WORKERS_INTERVAL=60
AUTO_IMPORT_WORKERS_REGION=us-east-1
AUTO_IMPORT_WORKERS_AMI_NAME=cisco-cml2.9-lablet-v0.1.*
LABS_REFRESH_INTERVAL=300
WORKER_METRICS_POLL_INTERVAL=180

# ============================================================================
# AWS Settings
# ============================================================================
# IMPORTANT: Set these in your environment or use AWS IAM roles in production
AWS_ACCESS_KEY_ID=AKIA5...
AWS_SECRET_ACCESS_KEY=R4tg...
