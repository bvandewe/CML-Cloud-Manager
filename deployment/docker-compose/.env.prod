# ============================================================================
# Production Environment Configuration for CML Cloud Manager
# ============================================================================
# This file contains environment variables for the production Docker Compose setup
# in deployment/docker-compose/docker-compose.prod.yml
#
# IMPORTANT: Do NOT use this file for local development!
# Local dev uses the .env file in the project root.

# ============================================================================
# Application Settings
# ============================================================================

# Python Path Configuration
PYTHONPATH=./src

# Application Settings
DEBUG=false
LOG_LEVEL=INFO
APP_HOST=0.0.0.0
APP_PORT=8080  # Internal container port

# ============================================================================
# Nginx Reverse Proxy Settings
# ============================================================================

# Nginx listens on port 80 (HTTP) and optionally 443 (HTTPS)
NGINX_PORT=80
NGINX_SSL_PORT=443

# External Port Mappings (legacy - now handled by nginx)
# These are kept for reference but nginx is the main entry point
API_EXTERNAL_PORT=8020
WORKER_EXTERNAL_PORT=8021  # For monitoring/health checks

# Keycloak Settings
KEYCLOAK_PORT=8090
KEYCLOAK_ADMIN_USERNAME=admin
KEYCLOAK_ADMIN_PASSWORD=change-me-in-production # pragma: allowlist secret
KEYCLOAK_REALM=cml-cloud-manager
KEYCLOAK_CLIENT_ID=cml-cloud-manager-public

# JWT Settings
JWT_SECRET_KEY=change-me-in-production-use-long-random-string # pragma: allowlist secret
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# Token Claim Validation
VERIFY_ISSUER=true
EXPECTED_ISSUER=http://localhost:8090/realms/cml-cloud-manager
VERIFY_AUDIENCE=true
EXPECTED_AUDIENCE=["cml-cloud-manager"]
REFRESH_AUTO_LEEWAY_SECONDS=60
SESSION_TIMEOUT_MINUTES=30

# ============================================================================
# Database Settings
# ============================================================================

# MongoDB Settings
MONGODB_PORT=27017
MONGODB_ROOT_USERNAME=root
MONGODB_ROOT_PASSWORD=change-me-in-production # pragma: allowlist secret
MONGODB_DATABASE=cml_cloud_manager
MONGODB_EXPRESS_PORT=8081

# ============================================================================
# Redis Settings
# ============================================================================

REDIS_PORT=6379
REDIS_ENABLED=true
REDIS_KEY_PREFIX=session:

# ============================================================================
# Infrastructure Services
# ============================================================================

# Event Player Settings
EVENT_PLAYER_PORT=8085

# OpenTelemetry Collector Settings
OTEL_COLLECTOR_GRPC_PORT=4317
OTEL_COLLECTOR_HTTP_PORT=4318
OTEL_COLLECTOR_METRICS_PORT=8888
OTEL_COLLECTOR_HEALTH_PORT=13133

# Grafana Settings
GRAFANA_PORT=3001

# Tempo Settings
TEMPO_PORT=3200

# Prometheus Settings
PROMETHEUS_PORT=9090

# Loki Settings
LOKI_PORT=3100

# ============================================================================
# Docker Network
# ============================================================================

DOCKER_NETWORK_NAME=cml-cloud-manager-net

# ============================================================================
# AWS Settings
# ============================================================================
# IMPORTANT: Set these in your environment or use AWS IAM roles in production

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# CML Worker Settings
CML_WORKER_AMI_NAME_DEFAULT=cisco-cml2.9-lablet-v0.1.7
CML_WORKER_INSTANCE_TYPE_DEFAULT=m5zn.metal
CML_WORKER_SECURITY_GROUP_IDS=["sg-xxxxxxxxxxxxxxxxx"]
CML_WORKER_SUBNET_ID=subnet-xxxxxxxxx
CML_WORKER_KEY_NAME=your-key-name
CML_WORKER_USERNAME=sysadmin
CML_WORKER_API_USERNAME=admin
CML_WORKER_API_PASSWORD=change-me-in-production # pragma: allowlist secret

# ============================================================================
# Background Job Settings
# ============================================================================

# Auto-import workers from AWS
AUTO_IMPORT_WORKERS_ENABLED=true
AUTO_IMPORT_WORKERS_INTERVAL=300
AUTO_IMPORT_WORKERS_REGION=us-east-1
AUTO_IMPORT_WORKERS_AMI_NAME=cisco-cml2.9-lablet-v0.1.*

# Labs refresh interval (seconds)
LABS_REFRESH_INTERVAL=1800

# Worker metrics polling interval (seconds)
WORKER_METRICS_POLL_INTERVAL=300
